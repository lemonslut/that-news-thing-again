<header class="mb-8">
  <h1 class="text-3xl font-bold">Trends</h1>
  <p class="text-base-content/60 mt-1">What's happening in the news right now</p>
</header>

<nav class="flex items-center justify-between mb-6 flex-wrap gap-4">
  <div class="flex items-center gap-2">
    <%= link_to "Hourly", trends_path(period: "hour"), class: "btn #{@period_type == 'hour' ? 'solid info' : 'outline info'} sm" %>
    <%= link_to "Daily", trends_path(period: "day"), class: "btn #{@period_type == 'day' ? 'solid info' : 'outline info'} sm" %>
  </div>

  <% if @available_periods.any? %>
    <div class="flex items-center gap-2">
      <span class="text-sm text-base-content/50">Period:</span>
      <select onchange="window.location.href = this.value" class="select bw sm">
        <% @available_periods.each do |period| %>
          <option value="<%= trends_path(period: @period_type, at: period.iso8601) %>" <%= 'selected' if period == @period_start %>>
            <%= @period_type == 'hour' ? period.strftime("%b %-d, %-I%p") : period.strftime("%b %-d, %Y") %>
          </option>
        <% end %>
      </select>
    </div>
  <% end %>
</nav>

<% if @stories.empty? %>
  <div class="text-center py-12 text-base-content/50">
    <p>No trend data for this period yet.</p>
    <p class="text-sm mt-2">Run <code class="bg-base-200 px-2 py-1 rounded">CaptureTrendsJob.perform_now</code> to capture current trends.</p>
  </div>
<% else %>
  <section>
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
      <span>Top Stories</span>
      <span class="badge outline bw xs"><%= @stories.size %></span>
    </h2>
    <div class="space-y-2">
      <% @stories.each do |snapshot| %>
        <% story = snapshot.trendable %>
        <% next unless story %>
        <div class="py-2 border-b border-base-300">
          <div class="flex items-center justify-between">
            <span class="text-base-content/40 text-sm w-6"><%= snapshot.rank %></span>
            <div class="flex-1 ml-2">
              <%= link_to story.title.truncate(80), story_path(story), class: "hover:text-primary transition-colors" %>
            </div>
            <%= trend_indicator(snapshot) %>
          </div>
          <div class="flex items-center gap-2 mt-1 ml-8 text-xs text-base-content/50">
            <span><%= snapshot.article_count %> articles this <%= @period_type %></span>
            <span>&middot;</span>
            <span><%= story.articles_count %> total</span>
          </div>
        </div>
      <% end %>
    </div>
  </section>
<% end %>
