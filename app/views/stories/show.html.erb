<nav class="mb-6">
  <%= link_to "â† Stories", stories_path, class: "btn outline info sm" %>
</nav>

<header class="mb-8">
  <h1 class="text-3xl font-bold"><%= @story.title %></h1>
  <div class="flex items-center gap-4 mt-2 text-base-content/60">
    <span><%= @story.articles_count %> articles</span>
    <% if @story.first_published_at && @story.last_published_at %>
      <span>&middot;</span>
      <span>
        <%= @story.first_published_at.strftime("%b %-d, %Y") %>
        <% if @story.first_published_at.to_date != @story.last_published_at.to_date %>
          - <%= @story.last_published_at.strftime("%b %-d, %Y") %>
        <% end %>
      </span>
    <% end %>
  </div>
  <% if @story.primary_concepts.any? %>
    <div class="flex items-center gap-2 mt-4 flex-wrap">
      <% @story.primary_concepts.each do |concept| %>
        <%= link_to concept_path(concept), class: "badge outline #{concept_type_color(concept.concept_type)} sm" do %>
          <%= concept.label %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</header>

<main class="relative">
  <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-base-300"></div>

  <div class="space-y-8 pl-12">
    <% @articles.each_with_index do |article, idx| %>
      <article class="relative">
        <div class="absolute -left-8 top-1 w-4 h-4 rounded-full bg-primary border-2 border-base-100"></div>

        <div class="flex items-center gap-2 mb-1 text-sm text-base-content/50">
          <time datetime="<%= article.published_at.iso8601 %>" class="font-medium">
            <%= article.published_at.strftime("%b %-d, %I:%M %p") %>
          </time>
          <span>&middot;</span>
          <span><%= article.source_name %></span>
          <% if article.sentiment %>
            <span>&middot;</span>
            <span class="<%= sentiment_color(article.sentiment) %>">
              <%= sentiment_indicator(article.sentiment) %><%= number_with_precision(article.sentiment, precision: 2) %>
            </span>
          <% end %>
        </div>

        <h2 class="text-lg font-semibold mb-2">
          <%= link_to article.title, article_path(article), class: "hover:text-primary transition-colors" %>
        </h2>

        <% if article.calm_summaries.any? %>
          <p class="text-base-content/70 text-sm"><%= article.calm_summaries.last.summary.truncate(200) %></p>
        <% end %>

        <% if article.concepts.any? %>
          <div class="flex items-center gap-1 mt-2 flex-wrap">
            <% article.concepts.limit(5).each do |concept| %>
              <span class="badge light <%= concept_type_color(concept.concept_type) %> xs"><%= concept.label.truncate(20) %></span>
            <% end %>
          </div>
        <% end %>
      </article>
    <% end %>
  </div>
</main>
